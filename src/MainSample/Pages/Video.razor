@page "/video"
@inject IJSRuntime JSRuntime

<video id="videoFeed" width="@widht" height="@height" />
<canvas class="d-none" id="@CanvasId" width="@widht" height="@height" />

<MCard>
    <MButton Block OnClick="Screenshot">截图</MButton>
</MCard>

<img id="@ImgId" />

@code {
    private string CanvasId;
    private string ImgId;

    private int widht = 520;
    private int height = 400;

    protected override async Task OnInitializedAsync()
    {
        // 记录issue https://github.com/dotnet/maui/issues/3694 解决了浏览器没有权限
        // 基本使用的一个博客地址 https://wellsb.com/csharp/aspnet/blazor-webcam-capture
        // 这里是初始化启动获取摄像头
        await JSRuntime.InvokeVoidAsync("startVideo", "videoFeed");

        ImgId = Guid.NewGuid().ToString("N");
        CanvasId = Guid.NewGuid().ToString("N");
    }

    private async Task Screenshot()
    {
        await JSRuntime.InvokeAsync<String>("setImgSrc", CanvasId, ImgId, widht, height);
    }

    [JSInvokable]
    public void ProcessImage(string imageString)
    {
        byte[] imageData = Convert.FromBase64String(imageString.Split(',')[1]);
    }
}